; NASM assembly for macOS ARM64

section .data
msg     db  "Hello world!", 0x0a  ; String with newline
msg_len equ $ - msg               ; Length of the string

section .text
global _start

_start:
    ; SYSCALL: write(1, msg, msg_len)
    mov x16, #4                   ; Syscall number for write (0x2000000 + 4)
    mov x0, #1                    ; File descriptor 1 (stdout)
    adrp x1, msg@PAGE             ; Load address of msg (page)
    add x1, x1, msg@PAGEOFF       ; Add offset to msg
    mov x2, #msg_len              ; Length of the string
    svc #0x80                     ; Call the kernel (macOS uses svc for syscalls)

    ; SYSCALL: exit(0)
    mov x16, #1                   ; Syscall number for exit (0x2000000 + 1)
    mov x0, #0                    ; Exit status 0
    svc #0x80                     ; Call the kernel