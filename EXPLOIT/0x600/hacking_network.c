#include <sys/socket.h>
#include <string.h>


/* 
 * This function accepts a socket FD and a ptr to a destination buffer.
 * It will receive from the socket until the EOL byte sequence is seen.
 * The EOL bytes are read from the socket, but the destination buffer
 * is null terminated (without the EOL bytes).
 * Returns the size of the received line (without EOL bytes).
 */
int recv_line(int sockfd, unsigned char *buffer) {
    unsigned char *ptr;
    int eol_matched = 0;
    
    ptr = buffer;
    while (recv(sockfd, ptr, 1, 0) == 1) {  /* Read 1 byte at a time */
        if (*ptr == '\n') {  /* If newline is received, break */
            eol_matched = 1;
            break;
        }
        if (*ptr != '\r') {  /* Ignore carriage return */
            ptr++;
        }
    }
    *ptr = '\0';  /* Null terminate the string */
    
    if (eol_matched)
        return strlen((char *)buffer);
    else
        return 0;
}