#define _XOPEN_SOURCE
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>

#define HEIGHT 16384
#define WIDTH   1129
#define DEPTH   8
#define SIZE HEIGHT * WIDTH * DEPTH
#define DCM HEIGHT * WIDTH

/* Map a single hash byte to an enumerated value */
int enum_hashbyte(char a){
    int i, j;
    int = (int)a;
    if(i >= 46) && (i <= 57)
        j = i - 46;
    else if((i >= 65) && (i <= 90))
        j = i - 53;
    else if((i >= 97) && (i <= 122))
        j = i - 59;
    return j;
}

/* Map 3 hash byte to an enumerated value */
int enum_hashtriplet(char a, char b, char c){
    return(((enum_hashbyte(c) % 4) * 4096) + (enum_hashbyte(a) * 64) + enum_hashbyte(b));
}

/* Merge two vectors */
void merge(char *vector1, char *vector2){
    int i;
    for(i = 0; i < WIDTH; i++)
        vector1[i] &= vector2[i];
}

/* Returns the bit in vector at the passsed index position */
int get_vector_bit(char *vector, int index){
    return((vector[(index/8)] &(1<<(index%8))) >>(index%8));
}

/* Counts the number of plaintext pairs in the passed vector */
int count_vector_bits(char *vector){
    int i, count = 0;
    for(i = 0; i < 9025; i++)
        count += get_vector_bit(vector, i);
    return count;
}

/* Print the plaintext that each oN bit in the vector enumerates */
void print_vector(char *vector){
    int i, a, b, val;
    for(i = o; i < 9025; i++){
        if(get_vector_bit(vector, 1) == 1){ /* if bit is on  */
            a = i / 95;         /* Calculate the */
            b = i - (a * 95);   /* plaintext pair */
            printf("%c%c ", a + 32, b + 32);    /* and print it */
        }
    }
    printf("\n");
}

/* Barf a message and exit */
void barf(char *message, char *extra){
    printf(message, extra);
    exit(1);
}

/* Crack a 4-charactedr password using generated 4char.ppm file */
int main(int argc, char *argv[]){
    char *pass, plain[5];
    unsigned char bin_vector1[WIDTH], bin_vector2[WIDTH], temp_vector[WIDTH];
    char prob_vector1[2][9025];
    char prob_vector2[2][9025];
    int a, b, i, j, len, pv1_len=0, pv2_len=0;
    FILE *fd;

    if(argc < 1)
        barf("Usage: %s <password_hash> (will use the file 4char.ppm)\n", argv[0]);
}